/* Coded by: emposha <admin@emposha.com> *//* Copyright: Emposha.com <http://www.emposha.com/> - Distributed under MIT - Keep this message! */jQuery(function(f){f.fn.fcbkcomplete=function(C){var v=f.isArray(C.used_vals)?C.used_vals:[];return this.each(function(){function y(){setTimeout(function(){var c=k.prev(),a=c.position();k.css({top:a.top+c.outerHeight(true),position:"absolute",left:a.left})},0)}function I(c,a){b.connect_with&&f(b.connect_with).each(function(){if(this!=l[0]){var d=f(this).data("setSelected");typeof d=="function"&&d(c,a)}})}function R(c){var a=0,d=f(c);f("div").each(function(){var h=parseInt(f(this).css("z-index")); if(d[0]!=this&&h>a)a=h});d.css({"z-index":a+1});if(b.forceWidth)e.css("width",b.width);else b.autoWidth&&e.css("width",k.width())}function S(){b.data&&f.isArray(b.data)?f.each(b.data,function(c,a){q.push({caption:a.name,value:a.id})}):l.children("option").each(function(c,a){a=f(a);if(a.hasClass("selected")||a.is(":selected")){w(a.text(),a.val(),true,a.hasClass("locked"));a.attr("selected","selected")}else a.removeAttr("selected");q.push({caption:a.text(),value:a.val()});x+=""+(q.length-1)+":"+a.text()+ ";"})}function w(c,a,d,h,s){if(!J())return false;var j=document.createElement("li"),z=document.createTextNode(c),m=document.createElement("a");h="bit-box"+(h?" locked":"");f(j).attr({"class":h,rel:a});f(j).prepend(z);f(m).attr({"class":"closebutton",href:"#"});j.appendChild(m);o.append(j);f(m).click(function(){K(f(this).parent("li"));return false});if(!d){D.remove();L(s);if(l.children("option[value="+a+"]").length){d=l.children("option[value="+a+"]");d.get(0).setAttribute("selected","selected");d.hasClass("selected")|| d.addClass("selected")}else{d=f(document.createElement("option"));d.attr("value",a).get(0).setAttribute("selected","selected");d.attr("value",a).addClass("selected");d.text(c);l.append(d)}if(b.connect_with=="Array"&&f.inArray(a,v)<0)v.push(a.toString());else b.connect_with&&b.connect_with!="Array"&&I(a.toString(),true);typeof b.onselect=="function"&&M(b.onselect,d);l.change()}o.children("li.bit-box.deleted").removeClass("deleted");e.hide();t&&r.hide()}function K(c){if(!c.hasClass("locked")){c.fadeOut("fast"); var a=c.attr("rel");if(b.connect_with=="Array"){var d=f.inArray(a,v);d>-1&&v.splice(d,1)}else b.connect_with&&b.connect_with!="Array"&&I(a,false);if(typeof b.onremove=="function"){a=l.children("option[value="+a+"]");M(b.onremove,a)}l.children('option[value="'+c.attr("rel")+'"]').removeAttr("selected").removeClass("selected");c.remove();l.change();E=0}}function L(c){var a=D=f(document.createElement("li"));n=f(document.createElement("input"));var d=0;a.attr({"class":"bit-input",id:u+"_annoninput"}); n.attr({type:"text","class":"maininput",size:"1"});o.append(a.append(n));n.focus(function(){k.fadeIn("fast")});n.blur(function(){k.fadeOut("fast")});o.click(function(){y();if(e.length&&(n.val().length||b.default_search.length)){if(b.default_search.length&&!n.val().length){n.focus();n.keyup()}e.show()}else{e.hide();t&&r.hide();k.children(".default").show()}});n.keypress(function(h){if(h.keyCode==13||h.keyCode==9)return false;n.attr("size",n.val().length+1)});n.keydown(function(h){if(h.keyCode==191){h.preventDefault(); return false}});n.keyup(function(h){var s=n.val(),j=N(s==""?b.default_search:s);if(h.keyCode==8&&j.length==0){e.hide();t&&r.hide();if(!o.children("li.bit-box:last").hasClass("locked"))if(o.children("li.bit-box.deleted").length==0){o.children("li.bit-box:last").addClass("deleted");return false}else{if(E)return;E=1;o.children("li.bit-box.deleted").fadeOut("fast",function(){K(f(this));return false})}}if(h.keyCode!=40&&h.keyCode!=38&&j.length!=0){A=0;if(b.json_url)if(b.cache&&O){F(j);G()}else{d++;var z= d;setTimeout(function(){if(z==d)f.getJSON(b.json_url+(b.json_url.indexOf("?")>-1?"&":"?")+"tag="+j,null,function(H){F(j,H);O=true;G()})},b.delay)}else{var m=undefined;if(b.preset_update){m=[];l.children("option").each(function(H,p){p=f(p);p.is(":selected")||p.is(".selected")||m.push({caption:p.text(),value:p.val()})})}F(j,m);G()}y();k.children(".default").hide();e.show()}});c&&setTimeout(function(){n.focus();y();k.children(".default").show()},1)}function F(c,a){e.html("");c=c==""?b.default_search: c;if(!b.cache&&a!=null){q=[];x=""}b.default_search!=c&&T(c);a!=null&&a.length&&f.each(a,function(H,p){q.push({caption:p.caption,value:p.value});x+=""+(q.length-1)+":"+p.caption+";"});var d=b.maxshownitems<q.length?b.maxshownitems:q.length,h="i";if(b.filter_case)h="";var s,j;try{s=eval("/(?:^|;)\\s*(\\d+)\\s*:[^;]*?"+c+"[^;]*/g"+h);j=s.exec(x)}catch(z){}for(h="";j!=null&&d>0;){j=q[j[1]];var m=f.inArray(j.value.toString(),B);if(m<0&&b.connect_with=="Array")m=f.inArray(j.value.toString(),v);if(m<0){m= l.children("option[value="+j.value+"]");if(m.length==0)m=l.children(":contains('"+j.value+"')");m=m.length>0&&b.filter_selected&&(m.is(".selected")||m.is(":selected"))}else m=true;if(!m){h+='<li rel="'+j.value+'">'+U(j.caption,c)+"</li>";A++;d--}j=s.exec(x)}e.append(h);if(b.firstselected){g=e.children("li:visible:first");g.addClass("auto-focus")}if(A>b.height){e.css({height:b.height*24+"px",overflow:"auto"});if(t){b.autoWidth&&r.css({width:e.width()+"px"});r.css({height:b.height*24+"px"}).show()}}else{e.css("height", "auto");if(t){b.autoWidth&&r.css({width:e.width()+"px"});r.css({height:e.height()+"px"}).show()}}}function U(c,a){if(b.filter_case)try{eval("var text = text.replace(/(.*)("+a+")(.*)/gi,'$1<em>$2</em>$3');")}catch(d){}else try{eval("var text = text.replace(/(.*)("+a.toLowerCase()+")(.*)/gi,'$1<em>$2</em>$3');")}catch(h){}return c}function P(){e.children("li").mouseover(function(){e.children("li").removeClass("auto-focus");f(this).addClass("auto-focus");g=f(this)});e.children("li").mouseout(function(){f(this).removeClass("auto-focus"); g=null})}function Q(){e.children("li").unbind("mouseover");e.children("li").unbind("mouseout");e.mousemove(function(){P();e.unbind("mousemove")})}function G(){var c=D.children(".maininput");P();e.children("li").unbind("mousedown");e.children("li").mousedown(function(){var a=f(this);w(a.text(),a.attr("rel"));e.hide();t&&r.hide();k.hide()});c.unbind("keydown");c.keydown(function(a){if(a.keyCode==191){a.preventDefault();return false}a.keyCode!=8&&o.children("li.bit-box.deleted").removeClass("deleted"); if(a.keyCode==13&&b.chooseOnEnter||a.keyCode==9&&b.chooseOnTab||a.keyCode==188&&b.chooseOnComma){if(V()){var d=g;w(d.text(),d.attr("rel"));k.hide();a.preventDefault();g=null}else if(b.newel){d=N(f(this).val());w(d,d);k.hide();a.preventDefault();g=null}b.keepPromptAfterChoose&&o.trigger("click");return false}if(a.keyCode==40){Q();if(g==null||g.length==0){g=e.children("li:visible:first");e.get(0).scrollTop=0}else{g.removeClass("auto-focus");g=g.nextAll("li:visible:first");d=parseInt(g.prevAll("li:visible").length, 10);var h=parseInt(g.nextAll("li:visible").length,10);if((d>Math.round(b.height/2)||h<=Math.round(b.height/2))&&typeof g.get(0)!="undefined")e.get(0).scrollTop=parseInt(g.get(0).scrollHeight,10)*(d-Math.round(b.height/2))}e.children("li").removeClass("auto-focus");g.addClass("auto-focus")}if(a.keyCode==38){Q();if(g==null||g.length==0){g=e.children("li:visible:last");e.get(0).scrollTop=parseInt(g.get(0).scrollHeight,10)*(parseInt(e.children("li:visible").length,10)-Math.round(b.height/2))}else{g.removeClass("auto-focus"); g=g.prevAll("li:visible:first");d=parseInt(g.prevAll("li:visible").length,10);h=parseInt(g.nextAll("li:visible").length,10);if((h>Math.round(b.height/2)||d<=Math.round(b.height/2))&&typeof g.get(0)!="undefined")e.get(0).scrollTop=parseInt(g.get(0).scrollHeight,10)*(d-Math.round(b.height/2))}e.children("li").removeClass("auto-focus");g.addClass("auto-focus")}})}function J(){if(b.maxitems!=0)return o.children("li.bit-box").length<b.maxitems?true:false}function T(c){if(b.newel&&J()){e.children("li[fckb=1]").remove(); if(c.length!=0){var a=f(document.createElement("li"));a.attr({rel:c,fckb:"1"}).html(c);e.prepend(a);A++}}}function M(c,a){var d="";for(i=0;i<a.get(0).attributes.length;i++)if(a.get(0).attributes[i].nodeValue!=null)d+='"_'+a.get(0).attributes[i].nodeName+'": "'+a.get(0).attributes[i].nodeValue+'",';d="{"+d+" notinuse: 0}";c.call(c,d)}function V(){if(g==null)return false;if(g.length==0)return false;return true}function N(c){c=c.replace(/[\"\'][\s]*javascript:(.*)[\"\']/g,'""');c=c.replace(/script(.*)/g, "");c=c.replace(/eval\((.*)\)/g,"");return c=c.replace("/([\u0000-\u0008,\u000b-\u000c,\u000e-\u0019])/","")}f(this).bind("addItem",function(c,a){w(a.title,a.value,0,0,0)});var b=f.extend({json_url:null,cache:false,height:"10",newel:false,firstselected:false,filter_case:false,filter_hide:false,complete_text:"Start to type...",default_search:".*?",maxshownitems:30,preset_update:true,maxitems:10,data:false,connect_with:false,onselect:"",onremove:"",delay:10,forceWidth:null,autoWidth:true,chooseOnComma:true, chooseOnTab:true,chooseOnEnter:true,keepPromptAfterChoose:true},C),o=null,e=null,k=null,A=0,q=[],O=false,x="",g=null,E=0,t=false,r,l=f(this),u=l.attr("id"),D=null,n=null,B=[];u=u!=""&&u!=null?u:"fcbkselect_"+Math.floor(Math.random()*1E5);(function(){l.hide();l.attr("multiple","multiple");l.attr("name").indexOf("[]")==-1&&l.attr("name",l.attr("name")+"[]");o=f(document.createElement("ul"));o.attr("class","holder");l.after(o);k=f(document.createElement("div"));k.addClass("facebook-auto");k.append('<div class="default">'+ b.complete_text+"</div>");if(t){k.append('<iframe class="ie6fix" scrolling="no" frameborder="0"></iframe>');r=k.children(".ie6fix")}e=f(document.createElement("ul"));e.attr("id",u+"_feed");k.prepend(e);o.after(k);e.css({position:"absolute"});if(b.forceWidth)e.css("width",b.width);else b.autoWidth&&e.css("width",k.width());S();y();L(0);R(k.parent());l.data("setSelected",function(c,a){var d=f.inArray(c,B);if(a&&d<0)B.push(c);else!a&&d>-1&&B.splice(d,1)})})();return this})}});