/* Coded by: emposha <admin@emposha.com> *//* Copyright: Emposha.com <http://www.emposha.com/> - Distributed under MIT - Keep this message! */jQuery(function(f){f.fn.fcbkcomplete=function(x){var s=x.used_vals!=undefined&&f.isArray(x.used_vals)?x.used_vals:[];return this.each(function(){function y(){setTimeout(function(){var c=l.prev(),a=c.position();l.css({top:a.top+c.outerHeight(true),position:"absolute","z-index":b.zIndex,left:a.left})},0)}function H(c,a){b.connect_with&&f(b.connect_with).each(function(){if(this!=j[0]){var d=f(this).data("setSelected");typeof d=="function"&&d(c,a)}})}function Q(c){var a=f(b.layer_selector);if(a!=null&& a.length>0){var d=0,g=f(c);f(b.layer_selector).each(function(){var o=parseInt(f(this).css("z-index"));if(g[0]!=this&&o>d)d=o});g.css({"z-index":d+1})}}function R(){b.data&&f.isArray(b.data)?f.each(b.data,function(c,a){q.push({caption:a.name,value:a.id});s.push(a.id)}):j.children("option").each(function(c,a){a=f(a);if(a.hasClass("selected")||a.is(":selected")){v(a.text(),a.val(),true,a.hasClass("locked"));a.attr("selected","selected");s.push(a.val())}else a.removeAttr("selected");q.push({caption:a.text(), value:a.val()});w+=""+(q.length-1)+":"+a.text()+";"})}function v(c,a,d,g,o){if(!I())return false;var i=document.createElement("li"),z=document.createTextNode(c),k=document.createElement("a");g="bit-box"+(g?" locked":"");f(i).attr({"class":g,rel:a});f(i).prepend(z);f(k).attr({"class":"closebutton",href:"#"});i.appendChild(k);m.append(i);f(k).click(function(){J(f(this).parent("li"));return false});if(!d){C.remove();K(o);if(j.children("option[value="+a+"]").length){d=j.children("option[value="+a+"]"); d.get(0).setAttribute("selected","selected");d.hasClass("selected")||d.addClass("selected")}else{d=f(document.createElement("option"));d.attr("value",a).get(0).setAttribute("selected","selected");d.attr("value",a).addClass("selected");d.text(c);j.append(d)}if(b.connect_with=="Array"&&f.inArray(a,s)<0)s.push(a.toString());else b.connect_with&&b.connect_with!="Array"&&H(a.toString(),true);typeof b.onselect=="function"&&L(b.onselect,d);j.change()}m.children("li.bit-box.deleted").removeClass("deleted"); e.hide();t&&r.hide()}function J(c){if(!c.hasClass("locked")){c.fadeOut("fast");var a=c.attr("rel");if(b.connect_with=="Array"){var d=f.inArray(a,s);d>-1&&s.splice(d,1)}else b.connect_with&&b.connect_with!="Array"&&H(a,false);if(typeof b.onremove=="function"){a=j.children("option[value="+a+"]");L(b.onremove,a)}j.children('option[value="'+c.attr("rel")+'"]').removeAttr("selected").removeClass("selected");c.remove();j.change();D=0}}function K(c){var a=C=f('<li class="bit-input" id="'+u+'_annoninput"><input type="text" class="maininput" size=1 /></li>'); n=a.children(":first");var d=0;m.append(a);n.focus(function(){l.fadeIn("fast")});n.blur(function(){l.fadeOut("fast")});m.click(function(){y();if(e.length&&(n.val().length||b.default_search.length)){if(b.default_search.length&&!n.val().length){n.focus();n.keyup()}e.show()}else{e.hide();t&&r.hide();l.children(".default").show()}});n.keypress(function(g){if(g.keyCode==13||g.keyCode==9)return false;n.attr("size",n.val().length+1)});n.keydown(function(g){if(g.keyCode==191){g.preventDefault();return false}}); n.keyup(function(g){var o=n.val(),i=M(o==""?b.default_search:o);if(g.keyCode==8&&i.length==0){e.hide();t&&r.hide();if(!m.children("li.bit-box:last").hasClass("locked"))if(m.children("li.bit-box.deleted").length==0){m.children("li.bit-box:last").addClass("deleted");return false}else{if(D)return;D=1;m.children("li.bit-box.deleted").fadeOut("fast",function(){J(f(this));return false})}}if(g.keyCode!=40&&g.keyCode!=38&&i.length!=0){A=0;if(b.json_url)if(b.cache&&N){E(i);F()}else{d++;var z=d;setTimeout(function(){if(z== d)f.getJSON(b.json_url+(b.json_url.indexOf("?")>-1?"&":"?")+"tag="+i,null,function(G){E(i,G);N=true;F()})},b.delay)}else{var k=undefined;if(b.preset_update){k=[];j.children("option").each(function(G,p){p=f(p);p.is(":selected")||p.is(".selected")||k.push({caption:p.text(),value:p.val()})})}E(i,k);F()}y();l.children(".default").hide();e.show()}});c&&setTimeout(function(){n.focus();y();l.children(".default").show()},1)}function E(c,a){e.html("");c=c==""?b.default_search:c;if(!b.cache&&a!=null){q=[]; w=""}b.default_search!=c&&S(c);a!=null&&a.length&&f.each(a,function(G,p){q.push({caption:p.caption,value:p.value});w+=""+(q.length-1)+":"+p.caption+";"});var d=b.maxshownitems<q.length?b.maxshownitems:q.length,g="i";if(b.filter_case)g="";var o,i;try{o=RegExp("(?:^|;)\\s*(\\d+)\\s*:[^;]*?"+c+"[^;]*"+g,"gi");i=o.exec(w)}catch(z){}for(g="";i!=null&&d>0;){i=q[i[1]];var k=f.inArray(i.value.toString(),B);if(k<0&&b.connect_with=="Array")k=f.inArray(i.value.toString(),s);if(k<0){k=j.children("option[value="+ i.value+"]");if(k.length==0)k=j.children(":contains('"+i.value+"')");k=k.length>0&&b.filter_selected&&(k.is(".selected")||k.is(":selected"))}else k=true;if(!k){g+='<li rel="'+i.value+'">'+T(i.caption,c)+"</li>";A++;d--}i=o.exec(w)}e.append(g);if(b.firstselected){h=e.children("li:first");h.addClass("auto-focus")}if(A>b.height){e.css({height:b.height*24+"px",overflow:"auto"});if(t){b.auto_width&&r.css({width:e.width()+"px"});r.css({height:b.height*24+"px"}).show()}}else{e.css("height","auto");if(t){b.auto_width&& r.css({width:e.width()+"px"});r.css({height:e.height()+"px"}).show()}}}function T(c,a){if(b.filter_case)try{c=c.replace(RegExp('(.*)("'+a+'")(.*)',"gi"),"$1<em>$2</em>$3")}catch(d){}else try{c=c.replace(RegExp('(.*)("'+a.toLowerCase()+'")(.*)',"gi"),"$1<em>$2</em>$3")}catch(g){}return c}function O(){e.children("li").mouseover(function(){e.children("li").removeClass("auto-focus");f(this).addClass("auto-focus");h=f(this)});e.children("li").mouseout(function(){f(this).removeClass("auto-focus");h=null})} function P(){e.children("li").unbind("mouseover");e.children("li").unbind("mouseout");e.mousemove(function(){O();e.unbind("mousemove")})}function F(){var c=C.children(".maininput");O();e.children("li").unbind("mousedown");e.children("li").mousedown(function(){var a=f(this);v(a.text(),a.attr("rel"));e.hide();t&&r.hide();l.hide()});c.unbind("keydown");c.keydown(function(a){if(a.keyCode==191){a.preventDefault();return false}a.keyCode!=8&&m.children("li.bit-box.deleted").removeClass("deleted");if(a.keyCode== 13&&b.choose_on_enter||a.keyCode==9&&b.choose_on_tab||a.keyCode==188&&b.choose_on_comma){if(U()){var d=h;v(d.text(),d.attr("rel"));l.hide();a.preventDefault();h=null}else if(b.newel){d=M(f(this).val());v(d,d);l.hide();a.preventDefault();h=null}b.keep_prompt_after_choose&&m.trigger("click");return false}if(a.keyCode==40){P();if(h==null||h.length==0){h=e.children("li:first");e.get(0).scrollTop=0}else{h.removeClass("auto-focus");h=h.next();d=parseInt(h.prevAll("li").length);var g=parseInt(h.nextAll("li").length); if((d>Math.round(b.height/2)||g<=Math.round(b.height/2))&&typeof h.get(0)!="undefined")e.get(0).scrollTop=parseInt(h.get(0).scrollHeight,10)*(d-Math.round(b.height/2))}e.children("li").removeClass("auto-focus");h.addClass("auto-focus")}if(a.keyCode==38){P();if(h==null||h.length==0){h=e.children("li:last");e.get(0).scrollTop=parseInt(h.get(0).scrollHeight)*(parseInt(e.children("li").length)-Math.round(b.height/2))}else{h.removeClass("auto-focus");h=h.prev();d=parseInt(h.prevAll("li").length);g=parseInt(h.nextAll("li").length); if((g>Math.round(b.height/2)||d<=Math.round(b.height/2))&&typeof h.get(0)!="undefined")e.get(0).scrollTop=parseInt(h.get(0).scrollHeight)*(d-Math.round(b.height/2))}e.children("li").removeClass("auto-focus");h.addClass("auto-focus")}})}function I(){if(b.maxitems!=0)return m.children("li.bit-box").length<b.maxitems?true:false}function S(c){if(b.newel&&I()){e.children("li[fckb=1]").remove();if(c.length!=0){var a=f(document.createElement("li"));a.attr({rel:c,fckb:"1"}).html(c);e.prepend(a);A++}}}function L(c, a){for(var d={},g=0;g<a.get(0).attributes.length;g++)if(a.get(0).attributes[g].nodeValue!=null)d["_"+a.get(0).attributes[g].nodeName]=a.get(0).attributes[g].nodeValue;c.call(j[0],d)}function U(){if(h==null)return false;if(h.length==0)return false;return true}function M(c){c=c.replace(/[\"\'][\s]*javascript:(.*)[\"\']/g,'""');c=c.replace(/script(.*)/g,"");c=c.replace(/eval\((.*)\)/g,"");return c=c.replace("/([\u0000-\u0008,\u000b-\u000c,\u000e-\u0019])/","")}f(this).bind("addItem",function(c,a){v(a.title, a.value,0,0,0)});var b=f.extend({json_url:null,cache:false,height:"10",newel:false,firstselected:false,filter_case:false,filter_hide:false,complete_text:"Start to type...",default_search:".*?",maxshownitems:30,preset_update:true,maxitems:10,data:false,connect_with:false,onselect:"",onremove:"",delay:10,zIndex:1,used_vals:[],force_width:null,auto_width:true,choose_on_comma:true,choose_on_tab:true,choose_on_enter:true,keep_prompt_after_choose:true,layer_selector:""},x),m=null,e=null,l=null,A=0,q=[], N=false,w="",h=null,D=0,t=false,r,j=f(this),u=j.attr("id"),C=null,n=null,B=[];u=u!=""&&u!=null?u:"fcbkselect_"+Math.floor(Math.random()*1E5);(function(){j.hide();j.attr("multiple","multiple");j.attr("name").indexOf("[]")==-1&&j.attr("name",j.attr("name")+"[]");m=f(document.createElement("ul"));m.attr("class","holder");j.after(m);l=f(document.createElement("div"));l.addClass("facebook-auto");l.append('<div class="default">'+b.complete_text+"</div>");if(t){l.append('<iframe class="ie6fix" scrolling="no" frameborder="0"></iframe>'); r=l.children(".ie6fix")}e=f(document.createElement("ul"));e.attr("id",u+"_feed");l.prepend(e);m.after(l);if(b.force_width)e.css("width",b.width);else b.auto_width&&e.css("width",l.width());R();y();K(0);Q();j.data("setSelected",function(c,a){var d=f.inArray(c,B);if(a&&d<0)B.push(c);else!a&&d>-1&&B.splice(d,1)})})();return this})}});